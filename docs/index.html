<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Minecraft in Browser</title>
  <style>
    body,html { margin:0; padding:0; overflow:hidden; height:100%; }
    #lwjgl { width:100%; height:100%; display:block; }
  </style>
</head>
<body>
  <canvas id="lwjgl"></canvas>

  <!-- 1) Load the CheerpJ 3 “cj3loader.js” nightly build from LeaningTech -->
  <script src="https://cjrtnc.leaningtech.com/3_20241010_541/cj3loader.js"></script>  <!-- :contentReference[oaicite:0]{index=0} -->

  <!-- 2) Define LWJGL JNI stubs (after loader, so they don’t conflict) -->
  <script>
    window.org_lwjgl_opengl_WindowsDisplay_nCreateWindow      = (w,h) => 0;
    window.org_lwjgl_opengl_WindowsDisplay_nSetTitle         = ptr => {};
    window.org_lwjgl_opengl_WindowsDisplay_nDestroyWindow    = () => {};
    window.org_lwjgl_opengl_WindowsDisplay_nIsCloseRequested = () => 0;
    window.org_lwjgl_opengl_WindowsDisplay_nPumpMessages     = () => {};
    window.org_lwjgl_opengl_WindowsDisplay_nMakeCurrent      = () => {};
    window.org_lwjgl_opengl_WindowsDisplay_nSwapBuffers      = () => {};
    window.org_lwjgl_opengl_WindowsDisplay_nConfigureDisplay = () => 0;
    // add more stubs here if new ReferenceErrors appear
  </script>

  <!-- 3) Launch logic (inline; no external main.js) -->
  <script>
    (async function(){
      if (typeof cheerpjInit !== 'function') {
        console.error('CheerpJ loader failed to define cheerpjInit().');
        return;
      }

      // a) initialize JVM (cj3loader auto-loads its WASM)
      await cheerpjInit();

      // b) bind LWJGL to our canvas
      const canvas = document.getElementById('lwjgl');
      cheerpjCreateDisplay(canvas.width, canvas.height);

      // c) fetch “latest” Minecraft client JAR URL
      const manifest = await fetch('https://launchermeta.mojang.com/mc/game/version_manifest.json').then(r=>r.json());
      const latestId = manifest.latest.release;
      const info     = manifest.versions.find(v=>v.id===latestId);
      const version  = await fetch(info.url).then(r=>r.json());

      // d) run the official client
      cheerpjRun({
        jar: version.downloads.client.url,
        mainClass: 'net.minecraft.client.Main',
        args: [
          '--gameDir','/usergame',
          '--version', version.id,
          '--width',   canvas.width,
          '--height',  canvas.height,
          '--accessToken','00000000-0000-0000-0000-000000000000'
        ]
      });
    })().catch(e=>{
      console.error('Startup error:', e);
    });
  </script>
</body>
</html>
