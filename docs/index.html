<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Minecraft in Browser</title>
  <style>
    body, html { margin:0; padding:0; overflow:hidden; height:100%; }
    #lwjgl { width:100%; height:100%; display:block; }
  </style>
</head>
<body>
  <canvas id="lwjgl"></canvas>

  <!-- 1) CheerpJ 4.0 loader from official CDN :contentReference[oaicite:3]{index=3} -->
  <script src="https://cjrtnc.leaningtech.com/4.0/loader.js"></script>

  <!-- 2) Inline LWJGL JNI stubs (no more 404s) -->
  <script>
    window.org_lwjgl_opengl_WindowsDisplay_nCreateWindow      = (w,h) => 0;
    window.org_lwjgl_opengl_WindowsDisplay_nSetTitle         = ptr => {};
    window.org_lwjgl_opengl_WindowsDisplay_nDestroyWindow    = () => {};
    window.org_lwjgl_opengl_WindowsDisplay_nIsCloseRequested = () => 0;
    window.org_lwjgl_opengl_WindowsDisplay_nPumpMessages     = () => {};
    window.org_lwjgl_opengl_WindowsDisplay_nMakeCurrent      = () => {};
    window.org_lwjgl_opengl_WindowsDisplay_nSwapBuffers      = () => {};
    window.org_lwjgl_opengl_WindowsDisplay_nConfigureDisplay = () => 0;
  </script>

  <!-- 3) Launch logic (inline, correct API calls) -->
  <script>
    (async function(){
      if (typeof cheerpjInit !== 'function') {
        console.error('CheerpJ loader failed to define cheerpjInit().');
        return;
      }

      // a) initialize the JVM (loader auto-loads its WASM)
      await cheerpjInit();

      // b) create an LWJGL display in our canvas :contentReference[oaicite:4]{index=4}
      const canvas = document.getElementById('lwjgl');
      cheerpjCreateDisplay(canvas.width, canvas.height);

      // c) fetch “latest” Minecraft client JAR URL
      const manifest = await fetch('https://launchermeta.mojang.com/mc/game/version_manifest.json')
                               .then(r=>r.json());
      const latestId = manifest.latest.release;
      const info     = manifest.versions.find(v=>v.id===latestId);
      const version  = await fetch(info.url).then(r=>r.json());

      // d) run the official client JAR from /app/… :contentReference[oaicite:5]{index=5}
      await cheerpjRunJar(
        '/app/minecraft-client.jar',
        '--gameDir','/usergame',
        '--version', version.id,
        '--width',   canvas.width,
        '--height',  canvas.height,
        '--accessToken','00000000-0000-0000-0000-000000000000'
      );
    })().catch(e=>{
      console.error('Startup error:', e);
    });
  </script>
</body>
</html>
